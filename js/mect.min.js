const WDHMS=7,YMDHMS=6,MDHMS=5,DHMS=4,HMS=3,MS=2,S=1;var intervalTimer=setInterval((function(){updateEverything()}),UPDATE_TIME),allEvents=[],currentFormat=getFormat(),weeksLeft=0,yearsLeft=0,monthsLeft=0,daysLeft=0,hoursLeft=0,minutesLeft=0,secondsLeft=0,FUTURE_EVENTS=1,PAST_EVENTS=2,ALL_EVENTS=3,pastEventIndexes=[],futureEventIndexes=[],currentEventsType=ALL_EVENTS,eventMoment=null,currentMoment=null,diff=null,timer=null;const NOT_COMPACT="notCompact",COMPACT="compact",ULTRA_COMPACT="ultraCompact";var compactType=getCompact();allEvents=getAllEvents();var timeElements=null,endTimeElements=null,percentElements=null,indexesArray=getCorrectIndexArray(currentEventsType);displayAllEvents(currentEventsType),updateEventStatistics();var visibleElements=[];function Event(e,t,n){this.name=e,this.dateTime=t,this.notifications=n}function updateEverything(){updateCurrentTime(),checkAllNotifications(),updateVisibleEvents(currentFormat)}function updateEventStatistics(){let e=0,t=0;for(const n of allEvents)hasEventPassed(returnCorrectDate(n.dateTime))?e+=1:t+=1;document.getElementById("statistics_div").innerText=`Total number of events: ${allEvents.length}\nPassed: ${e}\nUpcoming: ${t}\nPercent completed: ${(e/(e+t)*100).toFixed(2)}`}function addEvent(){const e=document.forms.eventForm.name.value,t=document.forms.eventForm.dateTime.value;let n=document.forms.eventForm.notifications.value.split(",");null!=n&&""!=n||(n=[0]),allEvents.push(new Event(e,t,n)),saveEvents(),displayAllEvents(currentEventsType),updateEventStatistics()}function quickAdd(e){const t=document.forms.quickAddForm.name.value;let n=new Date(now);n.setMinutes(n.getMinutes()+e),allEvents.push(new Event(t,convertDateToString(n),[0])),saveEvents(),displayAllEvents(currentEventsType),updateEventStatistics()}function convertDateToString(e){return`${e.getFullYear()}-${padNumber(e.getMonth()+1)}-${padNumber(e.getDate())} ${padNumber(e.getHours())}:${padNumber(e.getMinutes())}:${padNumber(e.getSeconds())}`}function saveEvents(){localStorage.setItem("allEvents",JSON.stringify(allEvents))}function deleteEvent(e){window.confirm(`Delete event ${e+1} (${allEvents[e].name})?`)&&(allEvents.splice(e,1),saveEvents(),displayAllEvents(currentEventsType),updateEventStatistics())}function exportEvent(e){const t=JSON.stringify(allEvents[e]);prompt("Copy this text",t)}function setEventType(e){indexesArray=getCorrectIndexArray(currentEventsType=1===e?FUTURE_EVENTS:2===e?PAST_EVENTS:ALL_EVENTS)}function findFutureOrPastEvents(e){const t=[];for(let n=0;n<allEvents.length;n++){const s=new Date(allEvents[n].dateTime),a=hasEventPassed(s);e!==FUTURE_EVENTS||a||t.push(n),e===PAST_EVENTS&&a&&t.push(n)}return t}function displayAllEvents(e){setEventType(e),deleteClassChildItems("an_event");let t=allEvents.length,n=0;switch(e){case FUTURE_EVENTS:t=(futureEventIndexes=findFutureOrPastEvents(FUTURE_EVENTS)).length;break;case PAST_EVENTS:t=(pastEventIndexes=findFutureOrPastEvents(PAST_EVENTS)).length;break;default:}for(indexesArray=getCorrectIndexArray(currentEventsType),n=0;n<t;n++){let t=[],s=0;switch(e){case FUTURE_EVENTS:t=allEvents[futureEventIndexes[n]],s=futureEventIndexes[n];break;case PAST_EVENTS:t=allEvents[pastEventIndexes[n]],s=pastEventIndexes[n];break;default:t=allEvents[n],s=n}const a=t.dateTime,o=returnCorrectDate(a),r=t.endDateTime;let i=null,c=!1;void 0!==r&&(c=!0,i=returnCorrectDate(r));let l=document.createElement("fieldset");if(compactType==ULTRA_COMPACT&&(l=document.createElement("div")),l.classList.add("an_event"),compactType==ULTRA_COMPACT){l.innerHTML=`(${s+1}) ${t.name}: `;const e=document.createElement("div");e.classList.add("timeUntil"),e.classList.add("ultraCompactTimeUntil"),e.id=`time_${s}`,e.innerHTML="---",l.appendChild(e),c&&(l.innerHTML+=" - ");const n=document.createElement("div");n.classList.add("endTimeUntil"),n.classList.add("ultraCompactTimeUntil"),l.appendChild(n);document.getElementById("users_events").appendChild(l);continue}const m=document.createElement("legend"),d=document.createTextNode(`(${s+1}) ${t.name}`);m.appendChild(d),l.appendChild(m);const E=document.createElement("div");if(E.classList.add("index"),l.appendChild(E),compactType==NOT_COMPACT){const e=document.createElement("div"),t=twelveHourTime(o);e.innerHTML=`Date: ${a} (${t})`,l.appendChild(e);const n=document.createElement("div");n.innerHTML=`Expanded: ${o.toString()}`,l.appendChild(n)}const u=document.createElement("div");u.classList.add("timeUntil"),u.id=`time_${s}`,u.innerHTML="---",l.appendChild(u);const f=document.createElement("div"),T=document.createElement("div"),v=document.createElement("div"),_=document.createElement("div");if(c&&compactType==NOT_COMPACT){const e=twelveHourTime(i);f.innerHTML=`End Date: ${r} (${e})`,T.innerHTML=`Expanded: ${i.toString()}`}if(v.classList.add("endTimeUntil"),_.classList.add("percent"),l.appendChild(f),l.appendChild(T),l.appendChild(v),l.appendChild(_),compactType==NOT_COMPACT){const e=document.createElement("div");e.innerHTML=`Notifications: ${t.notifications}`,l.appendChild(e);const n=document.createElement("button");n.innerHTML="Export",n.classList.add("event_button"),n.onclick=function(){exportEvent(s)},l.appendChild(n);const a=document.createElement("button");a.innerHTML="Export and Delete",a.classList.add("event_button"),a.onclick=function(){exportEvent(s),deleteEvent(s)},l.appendChild(a);const o=document.createElement("button");o.innerHTML="Delete",o.classList.add("event_button"),o.onclick=function(){deleteEvent(s)},l.appendChild(o);const r=document.createElement("button");r.innerHTML="Reset From Now",r.classList.add("event_button"),r.onclick=function(){resetFromNow(s)},l.appendChild(r)}const N=document.createElement("br");N.classList.add("an_event");const p=document.getElementById("users_events");p.appendChild(l),p.appendChild(N)}timeElements=document.getElementsByClassName("timeUntil"),endTimeElements=document.getElementsByClassName("endTimeUntil"),percentElements=document.getElementsByClassName("percent")}function changeCompact(){const e=document.getElementById("compact_picker").value;localStorage.setItem("compactType",e),compactType=getCompact(),displayAllEvents(currentEventsType)}function getCompact(){const e="compactType",t=localStorage.getItem(e);return null!=t?t:(localStorage.removeItem(e),localStorage.setItem(e,"notCompact"),NOT_COMPACT)}function sortEvents(e){1===e?allEvents.sort(((e,t)=>returnCorrectDate(e.dateTime)-returnCorrectDate(t.dateTime))):allEvents.sort(((e,t)=>returnCorrectDate(t.dateTime)-returnCorrectDate(e.dateTime))),saveEvents(),displayAllEvents(currentEventsType)}function checkNotifications(e,t){if("enabled"!==getNotificationStatus())return;const n=e.notifications;if(null==n)return;const s=n.length,a=e.name;if(0==s&&isTimeToNotify(0,t))createNotification(`"${a}" has occurred`,"",!0);else if(s>0&&n[0]>=0)for(const e of n)if(isTimeToNotify(e,t)){let t=`${e} minutes until "${a}"`;0==e&&(t=`"${a}" has occurred`),createNotification(t,"",!0)}}function returnCorrectDate(e){return/^[0-9]{8}T[0-9]{6}Z$/.test(e)?moment(e,"YYYYMMDDTHHmmssZ").toDate():new Date(e)}function getCorrectIndexArray(e){switch(e){case ALL_EVENTS:return[...allEvents];case FUTURE_EVENTS:return[...futureEventIndexes];case PAST_EVENTS:return[...pastEventIndexes];default:return[...allEvents]}}function checkAllNotifications(){for(const e of allEvents){const t=new Date(e.dateTime);if(!hasEventPassed(t)){checkNotifications(e,getMsFromNowUntilDate(t))}}}function checkVisibleEvents(){visibleElements=[];const e=[];let t="";for(let n=0;n<indexesArray.length;n++)t=currentEventsType===ALL_EVENTS?`time_${n}`:`time_${indexesArray[n]}`,isElementVisible(document.getElementById(t))&&e.push(n);return null==e?[]:e}function updateVisibleEvents(e){if(null==visibleElements)return;let t="",n="";for(let s=0;s<visibleElements.length;s++){const a=currentEventsType==ALL_EVENTS?allEvents[visibleElements[s]]:allEvents[indexesArray[s]],o=currentEventsType==ALL_EVENTS?visibleElements[s]:indexesArray[s],r=returnCorrectDate(a.dateTime),i=a.endDateTime,c=getMsFromNowUntilDate(r),l=hasEventPassed(r),m=document.getElementById(`time_${o}`);if(setTimeLeft(r,e,c),l?(n="Passed:",m.style.color=PASSED_COLOR):(n="Upcoming:",m.style.color=UPCOMING_COLOR),setInnerText(m,e,n),void 0!==i){const s=returnCorrectDate(i),a=hasEventPassed(s);a?(n="Passed:",endTimeElements[o].style.color=PASSED_COLOR):(n="Upcoming:",endTimeElements[o].style.color=UPCOMING_COLOR);const c=getMsFromNowUntilDate(s);setTimeLeft(s,e,c),setInnerText(endTimeElements[o],e,n);const l=Math.abs(r.getTime()-s.getTime()),m=(l-c)/l*100;t=m>100||m<0||a?"--- finished, --- left":`${m.toFixed(3)} % finished, ${(100-m).toFixed(3)} % left`;try{percentElements[o].innerText=t}catch(e){}}}}function setInnerText(e,t,n){switch(t){case 7:e.innerText=compactType==ULTRA_COMPACT?`${weeksLeft} wk, ${daysLeft} day, ${hoursLeft} hr, ${minutesLeft} min, ${secondsLeft} sec`:`${n} ${weeksLeft} weeks, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 6:e.innerText=compactType==ULTRA_COMPACT?`${yearsLeft} yr, ${monthsLeft} mon, ${daysLeft} day, ${hoursLeft} hr, ${minutesLeft} min, ${secondsLeft} sec`:`${n} ${yearsLeft} years, ${monthsLeft} months, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 5:e.innerText=compactType==ULTRA_COMPACT?`${monthsLeft} mon, ${daysLeft} day, ${hoursLeft} hr, ${minutesLeft} min, ${secondsLeft} sec`:`${n} ${monthsLeft} months, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 4:e.innerText=compactType==ULTRA_COMPACT?`${daysLeft} day, ${hoursLeft} hr, ${minutesLeft} min, ${secondsLeft} sec`:`${n} ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 3:e.innerText=compactType==ULTRA_COMPACT?`${hoursLeft} hr, ${minutesLeft} min, ${secondsLeft} sec`:`${n} ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 2:e.innerText=compactType==ULTRA_COMPACT?`${minutesLeft} min, ${secondsLeft} sec`:`${n} ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 1:e.innerText=compactType==ULTRA_COMPACT?`${secondsLeft} sec`:`${n} ${secondsLeft} seconds`;break;default:e.innerText="Error"}}function clearEvents(){localStorage.removeItem("allEvents"),localStorage.setItem("allEvents","[]"),allEvents=getAllEvents(),displayAllEvents(currentEventsType),updateEventStatistics()}function exportEvents(e){1===e?(prompt("Copy this text",JSON.stringify(allEvents)),alert(JSON.stringify(allEvents))):alert(JSON.stringify(allEvents,null,2))}function importEvents(){const e=prompt("Enter the text to import");null==e||""==e?alert("INVALID INPUT"):(localStorage.removeItem("allEvents"),localStorage.setItem("allEvents",e),allEvents=getAllEvents(),displayAllEvents(currentEventsType))}function changeFormat(){switch(parseInt(document.getElementById("format_picker").value)){case 7:currentFormat=7;break;case 6:currentFormat=6;break;case 5:currentFormat=5;break;case 4:currentFormat=4;break;case 3:currentFormat=3;break;case 2:currentFormat=2;break;case 1:currentFormat=1;break;default:currentFormat=6}currentFormat=parseInt(currentFormat,10),localStorage.setItem("currentFormat",currentFormat)}function getFormat(){let e=localStorage.getItem("currentFormat");return null==e&&(e=6),parseInt(e,10)}function setTimeLeft(e,t,n){switch(t){case 7:n-=(weeksLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY/DAYS_IN_WEEK))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY*DAYS_IN_WEEK,n-=(daysLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY,n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 5:eventMoment=moment(e),currentMoment=moment(now),diff=moment.preciseDiff(eventMoment,currentMoment,!0),monthsLeft=diff.months+diff.years*MONTHS_IN_YEAR,daysLeft=diff.days,hoursLeft=diff.hours,minutesLeft=diff.minutes,secondsLeft=diff.seconds;break;case 4:n-=(daysLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY,n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 3:n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 2:n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 1:secondsLeft=Math.floor(n/MS_IN_SECOND);break;default:eventMoment=moment(e),currentMoment=moment(now),diff=moment.preciseDiff(eventMoment,currentMoment,!0),yearsLeft=diff.years,monthsLeft=diff.months,daysLeft=diff.days,hoursLeft=diff.hours,minutesLeft=diff.minutes,secondsLeft=diff.seconds}}function getAllEvents(){const e="allEvents";let t=localStorage.getItem(e);return null==t&&(localStorage.removeItem(e),localStorage.setItem(e,"[]"),t=localStorage.getItem(e)),JSON.parse(t)}function changePageTitle(){const e=prompt("Enter the new page title");null==e||""==e?alert("INVALID INPUT"):(localStorage.removeItem("pageTitle"),localStorage.setItem("pageTitle",e),loadPageTitle())}function loadPageTitle(){const e="pageTitle",t="Multiple Event Countdown Timers",n=localStorage.getItem(e);null!=n?document.title=n:(localStorage.removeItem(e),localStorage.setItem(e,t),document.title=t)}function resetFromNow(e){window.confirm(`Reset event ${e+1} (${allEvents[e].name}) to the current time?`)&&(allEvents[e].dateTime=convertDateToString(now),saveEvents(),displayAllEvents(currentEventsType),updateEventStatistics())}visibleElements=checkVisibleEvents(),loadPageTitle(),window.addEventListener("scroll",(function(){null!==timer&&clearTimeout(timer),timer=setTimeout((function(){visibleElements=checkVisibleEvents()}),200)}),!1);