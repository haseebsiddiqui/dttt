const WDHMS=7,YMDHMS=6,MDHMS=5,DHMS=4,HMS=3,MS=2,S=1;var intervalTimer=setInterval((function(){updateEverything()}),UPDATE_TIME),allEvents=[],currentFormat=getFormat(),weeksLeft=0,yearsLeft=0,monthsLeft=0,daysLeft=0,hoursLeft=0,minutesLeft=0,secondsLeft=0,FUTURE_EVENTS=1,PAST_EVENTS=2,ALL_EVENTS=3,pastEventIndexes=[],futureEventIndexes=[],currentEventsType=ALL_EVENTS,eventMoment=null,currentMoment=null,diff=null;function Event(e,t,n){this.name=e,this.dateTime=t,this.notifications=n}function updateEverything(){updateCurrentTime(),updateEvents(currentFormat)}function updateEventStatistics(){let e=0,t=0;for(const n of allEvents)hasEventPassed(returnCorrectDate(n.dateTime))?e+=1:t+=1;document.getElementById("statistics_div").innerText=`Total number of events: ${allEvents.length}\nPassed: ${e}\nUpcoming: ${t}`}function addEvent(){const e=document.forms.eventForm.name.value,t=document.forms.eventForm.dateTime.value;let n=document.forms.eventForm.notifications.value.split(",");null!=n&&""!=n||(n=[0]),allEvents.push(new Event(e,t,n)),saveEvents(),displayAllEvents(currentEventsType)}function quickAdd(e){const t=document.forms.quickAddForm.name.value;let n=new Date(now);n.setMinutes(n.getMinutes()+e),allEvents.push(new Event(t,convertDateToString(n),[0])),saveEvents(),displayAllEvents(currentEventsType)}function convertDateToString(e){return`${e.getFullYear()}-${padNumber(e.getMonth()+1)}-${padNumber(e.getDate())} ${padNumber(e.getHours())}:${padNumber(e.getMinutes())}:${padNumber(e.getSeconds())}`}function saveEvents(){localStorage.setItem("allEvents",JSON.stringify(allEvents))}function deleteEvent(e){allEvents.splice(e,1),saveEvents(),displayAllEvents(currentEventsType)}function displayAllEvents(e){currentEventsType=1===e?FUTURE_EVENTS:2===e?PAST_EVENTS:ALL_EVENTS,deleteClassChildItems("an_event"),pastEventIndexes=[],futureEventIndexes=[];for(let t=0;t<allEvents.length;t++){const n=allEvents[t].dateTime,s=returnCorrectDate(n),r=allEvents[t].endDateTime;let a=null,o=!1;if(void 0!==r&&(o=!0,a=returnCorrectDate(r)),e===FUTURE_EVENTS||e===PAST_EVENTS)if(hasEventPassed(s)){if(pastEventIndexes.push(t),e===FUTURE_EVENTS)continue}else if(futureEventIndexes.push(t),e===PAST_EVENTS)continue;const i=document.createElement("fieldset");i.classList.add("an_event");const c=document.createElement("legend"),l=document.createTextNode(`(${t+1}) ${allEvents[t].name}`);c.appendChild(l),i.appendChild(c);const d=document.createElement("div");d.classList.add("index"),i.appendChild(d);const E=document.createElement("div"),u=twelveHourTime(s);E.innerHTML=`Date: ${n} (${u})`,i.appendChild(E);const f=document.createElement("div");f.innerHTML=`Expanded: ${s.toString()}`,i.appendChild(f);const m=document.createElement("div");m.classList.add("timeUntil"),i.appendChild(m);const N=document.createElement("div"),_=document.createElement("div"),I=document.createElement("div"),S=document.createElement("div");if(o){const e=twelveHourTime(a);N.innerHTML=`End Date: ${r} (${e})`,_.innerHTML=`Expanded: ${a.toString()}`}I.classList.add("endTimeUntil"),S.classList.add("percent"),i.appendChild(N),i.appendChild(_),i.appendChild(I),i.appendChild(S);const v=document.createElement("div");v.innerHTML=`Notifications: ${allEvents[t].notifications}`,i.appendChild(v);const T=document.createElement("button");T.innerHTML="Delete",T.classList.add("delete_button"),T.onclick=function(){deleteEvent(t)},i.appendChild(T);const M=document.createElement("br");M.classList.add("an_event");const h=document.getElementById("users_events");h.appendChild(i),h.appendChild(M)}}function sortEvents(e){1===e?allEvents.sort(((e,t)=>returnCorrectDate(e.dateTime)-returnCorrectDate(t.dateTime))):allEvents.sort(((e,t)=>returnCorrectDate(t.dateTime)-returnCorrectDate(e.dateTime))),saveEvents(),displayAllEvents(currentEventsType)}function checkNotifications(e,t){if("enabled"!==getNotificationStatus())return;const n=e.notifications;if(null==n)return;const s=n.length,r=e.name;if(0==s&&isTimeToNotify(0,t))createNotification(`"${r}" has occurred`,"",!0);else if(s>0&&n[0]>=0)for(const e of n)if(isTimeToNotify(e,t)){let t=`${e} minutes until "${r}"`;0==e&&(t=`"${r}" has occurred`),createNotification(t,"",!0)}}function returnCorrectDate(e){return/^[0-9]{8}T[0-9]{6}Z$/.test(e)?moment(e,"YYYYMMDDTHHmmssZ").toDate():new Date(e)}function getCorrectIndexArray(e){switch(e){case ALL_EVENTS:return[...allEvents];case FUTURE_EVENTS:return[...futureEventIndexes];case PAST_EVENTS:return[...pastEventIndexes];default:return[...allEvents]}}function updateEvents(e){const t=document.getElementsByClassName("timeUntil"),n=document.getElementsByClassName("endTimeUntil"),s=document.getElementsByClassName("percent"),r="#ff000d",a="#34eb4c";let o="",i="",c=[];c=getCorrectIndexArray(currentEventsType);for(let l=0;l<c.length;l++){const d=currentEventsType==ALL_EVENTS?allEvents[l]:allEvents[c[l]],E=returnCorrectDate(d.dateTime),u=d.endDateTime;if(void 0!==u){const t=returnCorrectDate(u),c=hasEventPassed(t);c?(i="Passed:",n[l].style.color=r):(i="Upcoming:",n[l].style.color=a);const d=getMsFromNowUntilDate(t);setTimeLeft(t,e,d),setInnerText(n[l],e,i);const f=Math.abs(E.getTime()-t.getTime()),m=(f-d)/f*100;o=m>100||m<0||c?"--- finished, --- left":`${m.toFixed(3)} finished, ${(100-m).toFixed(3)} left`,s[l].innerText=o}const f=getMsFromNowUntilDate(E),m=hasEventPassed(E);setTimeLeft(E,e,f),m||checkNotifications(d,f),m?(i="Passed:",t[l].style.color=r):(i="Upcoming:",t[l].style.color=a),setInnerText(t[l],e,i)}}function setInnerText(e,t,n){switch(t){case 7:e.innerText=`${n} ${weeksLeft} weeks, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 6:e.innerText=`${n} ${yearsLeft} years, ${monthsLeft} months, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 5:e.innerText=`${n} ${monthsLeft} months, ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 4:e.innerText=`${n} ${daysLeft} days, ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 3:e.innerText=`${n} ${hoursLeft} hours, ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 2:e.innerText=`${n} ${minutesLeft} minutes, ${secondsLeft} seconds`;break;case 1:e.innerText=`${n} ${secondsLeft} seconds`;break;default:e.innerText="Error"}}function clearEvents(){localStorage.removeItem("allEvents"),localStorage.setItem("allEvents","[]"),allEvents=getLocalStorageItem("allEvents"),displayAllEvents(currentEventsType)}function exportEvents(e){1===e?(prompt("Copy this text",JSON.stringify(allEvents)),alert(JSON.stringify(allEvents))):alert(JSON.stringify(allEvents,null,2))}function importEvents(){const e=prompt("Enter the text to import");null==e||""==e?alert("INVALID INPUT"):(localStorage.removeItem("allEvents"),localStorage.setItem("allEvents",e),allEvents=getLocalStorageItem("allEvents"),displayAllEvents(currentEventsType))}function changeFormat(e){switch(e){case 7:currentFormat=7;break;case 6:currentFormat=6;break;case 5:currentFormat=5;break;case 4:currentFormat=4;break;case 3:currentFormat=3;break;case 2:currentFormat=2;break;case 1:currentFormat=1;break;default:currentFormat=6}currentFormat=parseInt(currentFormat,10),localStorage.setItem("currentFormat",currentFormat)}function getFormat(){let e=localStorage.getItem("currentFormat");return null==e&&(e=6),parseInt(e,10)}function setTimeLeft(e,t,n){switch(t){case 7:n-=(weeksLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY/DAYS_IN_WEEK))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY*DAYS_IN_WEEK,n-=(daysLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY,n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 5:eventMoment=moment(e),currentMoment=moment(now),diff=moment.preciseDiff(eventMoment,currentMoment,!0),monthsLeft=diff.months+diff.years*MONTHS_IN_YEAR,daysLeft=diff.days,hoursLeft=diff.hours,minutesLeft=diff.minutes,secondsLeft=diff.seconds;break;case 4:n-=(daysLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR/HOURS_IN_DAY))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR*HOURS_IN_DAY,n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 3:n-=(hoursLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE/MIN_IN_HOUR))*MS_IN_SECOND*SEC_IN_MINUTE*MIN_IN_HOUR,n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 2:n-=(minutesLeft=Math.floor(n/MS_IN_SECOND/SEC_IN_MINUTE))*MS_IN_SECOND*SEC_IN_MINUTE,secondsLeft=Math.floor(n/MS_IN_SECOND);break;case 1:secondsLeft=Math.floor(n/MS_IN_SECOND);break;default:eventMoment=moment(e),currentMoment=moment(now),diff=moment.preciseDiff(eventMoment,currentMoment,!0),yearsLeft=diff.years,monthsLeft=diff.months,daysLeft=diff.days,hoursLeft=diff.hours,minutesLeft=diff.minutes,secondsLeft=diff.seconds}}allEvents=getLocalStorageItem("allEvents"),displayAllEvents(currentEventsType);